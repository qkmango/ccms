<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.qkmango.ccms.mvc.dao.AccountDao">

    <insert id="insert">
        insert into t_account
            (id, password, state, role, department)
        values (#{id}, #{password}, #{state}, #{role}, #{department})
    </insert>

    <select id="getAccountPassword" resultType="java.lang.String">
        select password
        from
        <if test="type == @cn.qkmango.ccms.domain.bind.Role@user">
            t_user
        </if>
        <if test="type == @cn.qkmango.ccms.domain.bind.Role@admin">
            t_admin
        </if>
        <if test="type == @cn.qkmango.ccms.domain.bind.Role@pos">
            t_pos
        </if>
        where id = #{id}
    </select>


    <update id="updatePassword">
        update
        <if test="role == @cn.qkmango.ccms.domain.bind.Role@user">
            t_user
        </if>
        <if test="role == @cn.qkmango.ccms.domain.bind.Role@admin">
            t_admin
        </if>
        <if test="role == @cn.qkmango.ccms.domain.bind.Role@pos">
            t_pos
        </if>
        set password = #{newPassword}
        where id = #{id} and password = #{oldPassword}
    </update>


    <update id="updateEmail">
        update
        <if test="account.role == @cn.qkmango.ccms.domain.bind.Role@user">
            t_user
        </if>
        <if test="account.role == @cn.qkmango.ccms.domain.bind.Role@admin">
            t_admin
        </if>
        set email = #{email}
        where id = #{account.id}
    </update>

    <update id="update">
        update
            t_account
        <if test="password != null and password != ''">
            set password = #{password}
        </if>
        <if test="state != null">
            set state = #{state}
        </if>
        where id = #{id}
    </update>


    <select id="getRecordById" resultType="cn.qkmango.ccms.domain.entity.Account">
        select id,
               state,
               role,
               department
        from t_account
        where id = #{id}
    </select>

    <select id="login" resultType="cn.qkmango.ccms.domain.entity.Account">
        select id,
               password,
               state,
               role
        from t_account
        where id = #{id}
    </select>

    <select id="list" resultType="cn.qkmango.ccms.domain.entity.Account">
        select SQL_CALC_FOUND_ROWS
        id,
        state,
        role,
        department
        from t_account
        <where>
            <if test="param != null">
                <if test="param.id != null and param.id != ''">
                    id = #{param.id}
                </if>
                <if test="param.state != null">
                    and state = #{param.state}
                </if>
                <if test="param.role != null">
                    and `role` = #{param.role}
                </if>
                <if test="param.department != null">
                    and department = #{param.department}
                </if>
            </if>
        </where>
        order by id asc
        <if test="pagination == true">
            LIMIT #{skipCount},#{limit}
        </if>
    </select>

    <resultMap id="AccountInfoVO" type="cn.qkmango.ccms.domain.vo.AccountDetailVO">
        <association property="account">
            <id property="id" column="id"/>
            <result property="name" column="name"/>
            <result property="email" column="email"/>
            <result property="role" column="type"/>
        </association>
    </resultMap>


</mapper>
